---
title: "Sissejuhatus v√µrgustikuanal√º√ºsi"
date: "`r format(Sys.time(), '%d %B, %Y')`"
author: Lisanna Lehes
output: 
  html_document:
    toc: true
    toc_float: true
    theme: spacelab
    highlight: tango
    fig_cap: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Kasulikud shortcutid R-i ja Markdowni kasutamiseks:**

-   **f1** = abistav info funktsiooni/paketi kohta

-   **ctrl + shift + c** = saab kommenteerida sektsiooni v√§lja

-   **ctrl + alt + I** = uus *code chunk* e. koodikast (.Rmd failis)

-   **ctrl + alt + M** = *pipe* e. `%>%`

# Vajalikud paketid

Vajadusel kasuta k√§sku `install.packages()`, et t√§naseks praktikumiks vajalikud paketid alla laadida.

```{r}
# install.packages("tidygraph")
# install.packages("ggraph")
# install.packages("visNetwork")
```

Laeme sisse vajalikud paketid.

```{r paketid, message = FALSE, warning = FALSE}
library(tidyverse)
library(tidygraph)
library(ggraph)
library(visNetwork)
```

V√µrgustiku kaks peamist komponenti on punktid (*nodes*) ja nendevahelised √ºhendused, mida nimetatakse seosteks (*edges*).

-   ***Nodes*** -\> punktid/s√µlmed

-   ***Edges*** -\> seosed/lingid punktide vahel

```{r pressure1, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/nodes_edges.jpg")
```

V√µrgustiku koostamiseks on vaja loendit m√µlemast. Seoste loend (*edge list*) on andmeraam, mis sisaldab v√§hemalt kahte veergu: √ºhte veergu punktidest, mis on √ºhenduse allikaks, ja teist veergu punktidest, mis on √ºhenduse sihtm√§rgiks. Andmetes olevad punktid identifitseeritakse unikaalsete ID-dega. Kui allika ja sihtm√§rgi eristamine on m√µttekas, on v√µrgustik suunatud (*directed*). Kui eristamine pole m√µttekas on v√µrk suunamata (*undirected*).

Seoste loend v√µib sisaldada ka t√§iendavaid veerge, mis kirjeldavad seoste atribuute, n√§iteks seose suurusj√§rku jms. Kui seostel on suurusj√§rgu atribuut (nt kaal), loetakse graafik kaalutuks (*weighted*).

```{r pressure3, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/graph1.jpg")
```

T√§nases praktikumis kasutame [`tidygraph`](https://tidygraph.data-imaginist.com/)'i, kuna `tidygraph` p√µhineb `dplyr` keskkonnal, on v√µimalik juurde p√§√§seda ka k√µikidele `dplyr` paketi erinevatele funktsionaalsustele.

J√§rgnevalt proovime andmestiku ka joonisele panna, selleks installige pakett `ggraph` ja v√µtke kasutusse. `ggraph` on laiendus `ggplot2`-le v√µrgustike anal√º√ºsiks. Seega on tegemist on paketiga, mis on m√µeldud olema v√µimalikult `ggplot` jooniste sarnane. Seega on teda v√µimalik redigeerida teile tuttavate vahenditega.

# 1. Sissejuhatus: lihtsamad v√µrgustikud

V√µrgustiku saame luua loome seoste loendist (*edges*) ja punktide loendist (*nodes*), kasutades funktsiooni `tbl_graph()`, mis on `tidygraph` paketi osa. Funktsioonis `tbl_graph()` m√§√§rame punktid (*nodes*) ja seosed (*edges*), kasutades vastavalt argumente `nodes =` ja `edges =`. `tbl_graph()` juures argument `directed =` `FALSE` v√µimaldaks √∂elda R-ile, et tahame luua suunamata v√µrgu (vaikev√§√§rtus `= TRUE`).

Kolme seosega (`edge`) suunamata v√µrgustik:

```{r}
# Create a tidygraph object directly
g1 <- tbl_graph(edges = data.frame(from = c(1, 2, 3), to = c(2, 3, 1)))

# Print the graph
print(g1)
plot(g1)
```

Punktide (*nodes*) arv v√µib olla suurem kui seoste (edge) arv:

```{r}
g2 <- tbl_graph(nodes = data.frame(name = 1:10),
                edges = data.frame(from = c(1, 2, 3),
                                   to = c(2, 3, 1)))

print(g2)
plot(g2)
```

Nimelised punktid (*nodes*):

```{r}
g3 <- tbl_graph(nodes = tibble::tibble(name = c("John", "Jim", "Jill")),
                 edges = tibble::tibble(
                   from = c("John", "Jim", "Jill"),
                   to = c("Jim", "Jill", "John")))
plot(g3)
```

Kasutades [`create_*()`](https://tidygraph.data-imaginist.com/reference/index.html) ja [`play*()`](https://tidygraph.data-imaginist.com/reference/index.html) saame luua lihtsa v√µrgustiku, et visualiseerida, kuidas erinevad v√µrgustiku paigutused ja struktuurid v√§lja n√§evad.

```{r}
create_ring(8)

plot(create_ring(8))
```

`play_gnm` -\> fikseeritud arvu **seoste** (*edges*) ja **punktidega** *(nodes)* juhuslik v√µrgustik.

```{r}
set.seed(13)
play_gnm(n = 8, m=13)

plot(play_gnm(n = 8, m=13, directed=F))
```

## Harjutus 1

Looge 7 punktiga t√§hekujuline suunatud v√µrgustik ‚≠ê

```{r}

```

# 2. Andmete laadimine

Uurime andmestikku, et m√µista, kuidas erinevad meediaorganisatsioonid on omavahel seotud. N√§iteks *use-case*'de pooleks v√µiks see meile teada anda, millist turunduskanalit on parem reklaami tegemiseks kasutada, st kus on liiklus suurem jne.

Praktikumi andmed p√§rinevad [Kaggle](https://www.kaggle.com/datasets/rahulgoel1106/network-analysis-data-from-various-sources/data)'st.

1.  *InputFileEdges.csv contains the information about the edges between nodes. The fields in this dataset are as follows:*
    (i) *from: source (or) starting node id of the edge*
    (ii) *to: target (or) ending node id of the edge*
    (iii) *weight: the number of times they were connected (or) referenced each other*
    (iv) *type: the type of the link (hyperlink or mention) between these nodes\**
2.  *InputFileNodes.csv contains the information about the nodes. The fields in this dataset are as follows:*
    (i) *id: unique node id*
    (ii) *media: the media information of the node (e.g. NY Times, Washington Post, Wall Street Journal etc.)*
    (iii) *media.type: the type of the media (1 represents Newspaper; 2 represents TV; and 3 represents Online)*
    (iv) *type.label: the type of the media (Newspaper, TV, and Online)*
    (v) *audience.size: the audience size for each media*

Andmete laadimine. Laeme sisse nii `edges` kui ka `nodes` faili.

```{r}
media.edge <- read.csv("data/InputFileEdges.csv")
media.node <- read.csv("data/InputFileNodes.csv")
```

```{r}
head(media.edge)
head(media.node)
```

V√µrgustikuanal√º√ºsi tegemiseks on vaja seoste ja punktide andmestike p√µhjal moodustada v√µrgustikuandmete objekt. Sedasorti andmeid hoiab pakett `tidygraph` objektis, mille t√º√ºp on `tbl_graph`. Objekti `tbl_graph` moodustades saab ette anda `nodes` ehk punktide nimekirja, `edges` ehk seoste nimekirja jt asju.

```{r}
media <- tbl_graph(nodes = media.node, edges = media.edge)
media 
```

-   V√§ljund annab meile infot punktide (17) ja seoste (51) arvu kohta; kas tegemist on suunatud v√µrgustikuga (momendil *directed* e. suunatud) ja mitu erinevat komponenti esineb (1). Viimane t√§hendab, et meil on justkui 1 alamv√µrgustik.

-   Seej√§rel n√§eme, et `tbl_graph` objektis on kaks alamandmestikku: Node Data ja Edge Data. Node Data sisaldab k√µiki unikaalseid v√§√§rtusi, mis on leitud Edge Data v√§√§rtusest *from* ja *to*. Edge Data kirjeldab k√µiki seoseid.

-   Lisaks on n√§ha, et Node Data on aktiivne (*active*). See t√§hendab, et me saame selle alamandmestikuga soovi korral teha vajalikke toiminguid teha, nt √ºmber j√§rjestada, midagi muuta, filtreerida vms, lubatud on erinevad `tidyverse`'i tehted (`mutate`, `select`, `filter`, `summarise` jne).

```{r}
plot(media)
```

Funktsioon `activate()` v√µimaldab juurdep√§√§su punktide v√µi seoste andmestikele.

```{r}
media %>% 
  activate(edges) %>% 
  as_tibble()
```

```{r}
media %>% 
  activate(nodes) %>% 
  as_tibble()
```

Nt nimekiri erinevatest allikatest meie andmestikus.

```{r}
media_list <- media %>% 
  activate(nodes) %>% 
  pull(media)

media_list
```

Siin on n√§ide sellest, kuidas on v√µimalik v√µrgustikku teatud kategooria alusel filtreerida, st kasutusele v√µtta `dplyr` funktsioonid.

```{r}
# type=="hyperlink"

media_h <- media %>% 
  activate(edges) %>% 
  filter(type=="hyperlink") 

plot(media_h)
```

```{r}
# type=="mention"

media_m <- media %>% 
  activate(edges) %>% 
  filter(type=="mention")

plot(media_m)
```

# 3. Joonised

`ggraph`i pakett sisaldab anal√º√ºsi jaoks ainulaadseid `geom_*`-funktsioone seoste ja punktide visualiseerimiseks. Nt `geom_pointi` asemel saame kasutada `geom_node_point`. Pikem nimekiri erinevatest v√µimalustest [siin (Nodes, Edges)](https://ggraph.data-imaginist.com/reference/index.html).

Joonise tegemiseks on vaja ette anda:

-   andmed (`tbl_graph` objekt);

-   soovitud √ºldine paigutus (`layout`);

-   seoste, punktide kujundus;

-   soovi korral muud asjad, mida `ggplot` v√µimaldab.

`layout` on punktide vertikaalne ja horisontaalne **paigutus** konkreetse v√µrgustiku struktuuri visualiseerimisel. `layout`i valik peaks olema kasutaja poolt l√§bim√µeldud, kuna sellel on suur m√µju l√µpptulemuse kujunemisele.

V√µrgustike visualiseerimisel tuleks silmas pidada seda, et kui on soov tehtud joonist korrata, peaks joonise tegemisele eelnema `set_seed()`. Kui seda ei kasuta, siis tuleb joonis iga kord natukene erinevalt.

```{r}
ggraph(media) + 
  geom_edge_link() + 
  geom_node_point()
```

`geom_edge_link()` v√µimaldab √ºhendusi sirgetega. Proovige, mida teevad `geom_edge_fan()`, `geom_edge_diagonal()` ja `geom_edge_arc()`.

```{r}

```

Peamine viis, kuidas v√µrgustiku joonist t√§iustada on punktide (*nodes*) ja seoste (*edges*) v√§rvi, suuruse jms muutmine.

```{r}
ggraph(media) + 
  geom_edge_link(edge_color = 'gray',# v√§rv
                 edge_width = 2, # laius
                 edge_linetype = 2) + # joone kuju, 0-6
  geom_node_point(alpha = 0.5, # l√§bipaistvus
                  colour = 'black', # punkti √§√§rise v√§rv
                  fill = 'red', # punkti v√§rv
                  size = 7, # punkti suurus
                  shape = 21, # punkti kuju, 0-25
                  stroke = 2) # √§√§rise laius
```

## Paigutus (layout)

Paigutuse ehk `layout`-i puhul on erinevaid v√µimalusi. `ggraph` pakub rohkem kui 20 erinevat paigutust. N√§iteks:

-   <https://igraph.org/c/doc/igraph-Layout.html>

-   <https://ggraph.data-imaginist.com/articles/Layouts.html>

-   <https://cran.r-project.org/web/packages/ggraph/vignettes/Layouts.html>

Kui `ggraphil` puudub vajalik paigutus, on alati v√µimalik luua enda funktsioon, kasutades `create_layout()`.

Kui `layout`-i mitte ette anda, valitakse automaatselt v√§lja √ºks v√µimalikest.

Nagu mainitud, tasub joonisel proovida l√§bi erinevaid v√µrgustiku paigutusi. Alustada v√µib n√§iteks nimekirjast: ‚Äòstar‚Äô, ‚Äòcircle‚Äô, ‚Äògem‚Äô, ‚Äòdh‚Äô, ‚Äògraphopt‚Äô, ‚Äògrid‚Äô, ‚Äòmds‚Äô, ‚Äòrandomly‚Äô, ‚Äòfr‚Äô, ‚Äòkk‚Äô, ‚Äòdrl‚Äô, ‚Äòlgl‚Äô, ‚Äòstress‚Äô. M√µned paigutused v√µivad vajada veidi pikemat optimeerimist.

```{r}
?layout_tbl_graph_igraph
```

```{r}
ggraph(media, layout = "graphopt") + 
  geom_edge_link() + 
  geom_node_point()
```

## Jooned

J√§rgnevalt proovime n√º√ºd muuta joonist selliselt, et suurem arv √ºksteisele viitamisi oleks n√§idatud paksema joonega. Selleks tuleks muuta `geom_edge_link` osa ning anda ette joone j√§meduse m√§√§ramiseks (parameeter `width`) vastav tunnus (praegu on viitamiste arv tunnuses nimega *weight*).

```{r}
ggraph(media, layout = "graphopt") + 
  geom_edge_link(aes(width = weight)) + 
  geom_node_point()
```

Teeme ilusamaks. Anname ette vahemikud k√µige peenema ja paksema joone laiuseks.

```{r}
ggraph(media, layout = "graphopt") + 
  geom_edge_link(aes(width = weight)) + 
  scale_edge_width_continuous(range = c(0.3, 2.1)) +
  geom_node_point(size = 3)
```

## Tekst

J√§rnevalt v√µiksime proovida lisada ka sildid e. *label*-id punktide juurde. Selleks on meil veerg *media*. Lisame sildid k√§suga `geom_node_text()`. `repel=TRUE` v√µimaldab teksti nihutada punktide k√µrvale, st takistab nn *overlapping*ut.

```{r}
ggraph(media, layout = "graphopt") + 
  geom_edge_link(aes(width = weight)) + 
  geom_node_point(size = 3) +
  scale_edge_width_continuous(range = c(0.3, 2.1)) +
  geom_node_text(aes(label = media), repel = TRUE)
```

```{r}
ggraph(media, layout = "gem") +
  geom_edge_link(color = "grey80", width = 2,
                 end_cap = circle(0.5,"cm"), 
                 start_cap = circle(0.5, "cm")) +
    geom_node_text(aes(label = media))
```

Sarnaselt `ggplot`ile, on ka siin v√µimalik kasutada erinevaid teema funktsioone. Lisame joonisele ka ‚Äúteema‚Äù ehk `theme_*` funktsiooni, mille erinevaid valikuid on n√§ha siit:¬†[https://ggplot2.tidyverse.org/reference/#themes](#0)

```{r warning=FALSE}
ggraph(media, layout = "graphopt") + 
  geom_edge_link(aes(width = weight)) + 
  geom_node_point(size = 3) +
  scale_edge_width_continuous(range = c(0.3, 2.1)) +
  geom_node_text(aes(label = media), repel = TRUE) +
  theme_graph()
```

Soovi korral saaksime m√§√§rata joonisele nii punkti kui seose omadusi s√µltuvalt m√µnest teisest tunnusest. Proovime n√§iteks teha joonise selliselt, et erineva t√º√ºbiga allikad oleks kujutatud erineva v√§rviga.

```{r warning=FALSE}
ggraph(media, layout = "graphopt") + 
  geom_edge_link(aes(width = weight)) + 
  geom_node_point(aes(color = type.label), size = 3) +
  scale_edge_width_continuous(range = c(0.3, 2.1)) +
  geom_node_text(aes(label = media), repel = TRUE) +
  theme_graph()
```

## V√§rvid

Sama asja visualiseerimiseks v√µime kasutada ka teisi v√§rve. Nagu `ggplot`i puhul ikka, saaks ka siin anda ette oma v√§rviskeemi.

```{r}
ggraph(media, layout = "graphopt") +
  geom_edge_link(aes(color = weight)) +
  geom_node_point()
```

Seekord on v√§rvide aluseks kasutatud punktide andmestikust v√§√§rtust *audience.size*. `scale_color_viridis` on v√§rvipalett.

```{r}
ggraph(media, layout = "graphopt") +
  geom_edge_link() +
  geom_node_point(aes(color = audience.size), size = 3) +
  scale_color_viridis()
```

Saame v√§rvida ka seose t√º√ºpi.

```{r warning=FALSE}
ggraph(media, layout = "graphopt") +
  geom_edge_fan(aes(color = type), width = .5) +
  geom_node_point(aes(color = audience.size), size = 3) +
  scale_color_viridis() +
  theme_graph()
```

## Punktid

Teine levinud l√§henemisviis v√µrgustiku osade esilet√µstmiseks on punktide (*nodes*) suuruse v√µi seoste (*edges*) laiuse muutmine. Muudame oma eelmist graafikut nii, et n√º√ºd p√µhineb punktide suurus publiku suurusel.

```{r warning=FALSE}
ggraph(media, layout = "graphopt") +
  geom_edge_fan(aes(color = type), width = .5) +
  geom_node_point(aes(size = audience.size)) +
  scale_color_viridis() +
  theme_graph()
```

## Muud

Antud andmestiku puhul on tegu suunatud v√µrgustikuga, aga ainult joonte p√µhjal see info kahjuks v√§lja ei tule. √úheks v√µimaluseks on kasutada joonisel nooli -\> `arrow()`. Samuti on joonist v√µimalik muuta l√§bi `aes()` funktsiooni, nt punktide v√§rv ja silt (*label*).

```{r warning=FALSE}
set.seed(123)

media %>% 
ggraph(layout = 'graphopt') + 
    geom_edge_link(arrow = arrow(length = unit(2, 'mm')), 
                   end_cap = circle(3, 'mm')) +
  geom_node_point(size = 3) +  
  geom_node_text(aes(label = media, color = type.label), size=3, repel = T) +
  theme_graph()
```

V√µimalik on ka alamjooniste tegemine m√µne kategooria alusel nii punktide andmestiku kui ka seoste andmestiku l√µikes. Selleks saab kasutada `facet_nodes` kui ka `facet_edges`.

```{r warning=FALSE}
ggraph(media, layout = 'gem') + 
    geom_edge_link(arrow = arrow(length = unit(2, 'mm')), 
                   end_cap = circle(3, 'mm')) + 
    geom_node_point(size = 3) +
  geom_node_text(aes(label = media), size=3, repel = T) +
  facet_nodes(~type.label) + 
  theme_graph(foreground = 'steelblue')
```

## Harjutus 2

Vastipidiselt eelmisele n√§itele, proovige n√º√ºd luua alamjoonised [seoste t√º√ºbi]{.underline} l√µikes. Eristage erinevad [punktide t√º√ºbid]{.underline} (*type.label*) eri v√§rvidega.

```{r warning=FALSE}

```

# 4. N√§itajad v√µrgustiku kohta

Lisaks v√µrgustike visualiseerimisele, saame neid ka l√§hemalt anal√º√ºsida l√§bi n√§itajate, mis kirjeldavad v√µrgustike struktuurilisi omadusi.

## *Centrality* e. kesksus

Kesksuse m√µ√µdikud annavad kvantitatiivset konteksti punktide (*nodes*) t√§htsuse kohta v√µrgustikus. Mida k√µrgem on kesksus, seda kesksem on punkt (*node*). Kesksuse m√§√§ratlemiseks on mitmeid m√µ√µdikuid. Igal kesksuse m√µ√µdikul on erinev kasutus ja t√µlgendus.

```{r pressure2, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/centrality.webp")
```

Lisaks on veel palju erinevaid m√µ√µdikuid v√µrgustike anal√º√ºsimiseks, mida √ºhe praktikumiga lihtsalt l√§bi ei j√µua v√µtta: [Centrality, Node Measures, Edge Measures, Graph measures](https://tidygraph.data-imaginist.com/reference/index.html).

### ***Degree Centrality*** **e. astmekesksus**

Astmekesksus n√§itab, [kui palju √ºhendusi konkreetsel punktil on.]{.underline} See m√µ√µde aitab tuvastada k√µige aktiivsemad punktid v√µrgustikus. St n√§itab, kui palju seoseid √ºhel punktil on. Suunatud ja suunamata v√µrgustike puhul on arvutused m√µnev√µrra erinevad (st vaadelda saab nii sissetulevate, v√§ljaminevate kui ka m√µlema √ºhenduste summat), kuid idee on sama: mitu otsest, √ºhe h√ºppega, √ºhendust on igal punktil v√µrgustiku teiste punktidega.

Seoste andmestikus on meil ka kaalud, kasutame neid siin.

```{r}
media %>% 
  activate(nodes) %>% 
  mutate(degree_c = centrality_degree(mode = 'total', weights = weight)) %>% 
  arrange(desc(degree_c)) %>% 
  slice(1:3)
```

Vaatame milline on astmekesksuse jaotus meie v√µrgustikus.

```{r warning=FALSE}
media %>% 
  activate(nodes) %>%
  mutate(degree = centrality_degree(mode = 'total', weights = weight)) %>% 
  as_tibble() %>% 
  ggplot() + 
  geom_histogram(mapping = aes(x = degree))
```

Tsentraalsuse m√µ√µdikuid saab kasutada ka joonistel.

```{r warning=FALSE}
plot_centrality = media %>% 
  activate(nodes) %>%
  mutate(degree = centrality_degree(mode = 'total', weights = weight)) 
  
ggraph(plot_centrality, layout = 'stress') + 
  geom_edge_link() + 
  geom_node_point(aes(size = degree, colour = degree)) + 
  scale_color_continuous(guide = 'legend') + 
  theme_graph()
```

### ***Eigenvector Centrality*** **e. omavektorkesksus**

Omavektorkesksus m√µ√µdab, kuidas on seotud punkt ja kui palju see v√µib otseselt m√µjutada v√µrgustiku teisi √ºhendatud punkte. Sarnaneb astmekesksusele, aga [n√§itab kui seotud ja kui tugev m√µju on v√µrgus]{.underline}: rohkem seoseid tugevamate (k√µrgema omavektorkesksusega) punktidega annab punktile k√µrgema omavektorkesksuse v√§√§rtuse. Seega saab tipul olla suurem omavektorkesksus, kui on rohkem (t√§htsaid) √ºhendusi.

```{r}
media %>% 
  activate(nodes) %>% 
  mutate(eigen = centrality_eigen(weights = weight, directed = T)) %>% 
  arrange(desc(eigen)) %>% 
  slice(1:3)
```

### ***Closeness centrality*** **e. l√§heduskesksus**

L√§heduskesksus [m√µ√µdab, mitu sammu on vaja antud punktist igale teisele punktile juurdep√§√§suks.]{.underline} Teisis√µnu, olulistel punktidel on mitme √ºhenduse korral lihtne juurdep√§√§s teistele punktidele. Punktil, millel on k√µrge l√§heduskesksuse m√µ√µde omab l√ºhimaid teid teiste punkideni ehk k√µrgeima l√§heduskesksusega punkte peetakse punktideks, mis suudavad teavet levitada kiiremini kui teised. Ehk v√µimaldab leida need v√µrgustiku liikmed, kellel on k√µige parem positsioon kogu v√µrgustiku m√µjutada.

```{r}
media %>% 
  activate(nodes) %>% 
  mutate(closeness_c = centrality_closeness(weights = weight, mode = 'total')) %>% 
  arrange(desc(closeness_c)) %>% 
  slice(1:3)
```

### ***Betweenness Centrality*** **e. vahelisuskesksus**

J√§rjestab punktid v√µrgustikku l√§bivate √ºhenduste alusel ja m√µ√µdab iga punkti kaudu l√§bitavate teekondade arvu. N√§itab, [kui tihti j√§√§b antud punkt k√µigi teiste punktide vahelistele teekondadele.]{.underline} Ehk kui v√µtta k√µik teede kombinatsioonid, siis kui tihti j√§√§b antud punkt k√µigi teiste punktide vahelistele teekondadele. Suure vahelisuskesksusega punktid toimivad tavaliselt sillana mitmete muude oluliste punktide jaoks, mis nn levitavad teavet k√µige laiemalt ehk kui olulised on punktid v√µrgustiku teabevoos.

```{r}
media %>% 
  activate(nodes) %>% 
  mutate(betweenness_c = centrality_betweenness(weights = weight, 
                                                directed = T)) %>% 
  arrange(desc(betweenness_c)) %>% 
  slice(1:3)
```

```{r warning=FALSE}
media_betw = media %>%
                activate(nodes) %>%
                mutate(betweenness_c = centrality_betweenness(weights = weight, 
                                                directed = T))

media_betw %>% 
  ggraph(layout = 'nicely') + 
  geom_edge_link() + 
  geom_node_point(aes(size = betweenness_c, colour = betweenness_c)) + 
  scale_color_continuous(guide = 'legend') + 
  theme_graph()
```

## Harjutus 3

Proovime tsentraalsuse m√µ√µdikud ka kuidagi joonisele panna. Arvutage meie andmestikule *degree centrality* ja *betweenness centrality*. Proovige kuvada m√µlemad m√µ√µdikud v√µrgustiku joonisel. M√µelge, kuidas seda teha - punktide v√§rv, suurus jms.

```{r warning=FALSE}

```

## Harjutus 4

Kasutame ainult vahelisuskesksust (*betweenness centrality*), aga seekord proovime eristada joonisel ka punktid allika t√º√ºbi l√µikes (*type.label*).

```{r warning=FALSE}

```

## V√µrgustiku *key player*i leidmine

J√§rgnevalt proovime leida `media` v√µrgustiku nn *key player*'i ehk v√µrgustiku silmapaistvama liikme. *Key player* on termin v√µrgu k√µige m√µjukamate liikmete jaoks, mis p√µhineb erinevatel n√§idikutel, mis on antud juhul erinevad kesksuse (*centrality*) m√µ√µdikud. Kasutajat, kellel on k√µigi kesksuse n√§idikud k√µrged, v√µib pidada kogu v√µrgustiku nn v√µtmem√§ngijaks.

```{r warning=FALSE}
 media_nw = media %>% 
  mutate(degree_c = centrality_degree(mode = 'total', weights = weight)) %>%
  mutate(betweenness_c = centrality_betweenness(weights = weight,directed = T)) %>%
  mutate(closeness_c = centrality_closeness(weights = weight, mode = 'total')) %>%
  mutate(eigen = centrality_eigen(weights = weight, directed = T))
 
media_nw %>% slice(1:6)
```

Selleks teeme eelnevalt saadud tulemused `dataframe`'ks

```{r}
media_nw_df <- as.data.frame(media_nw %>% activate(nodes))
media_nw_df
```

```{r}
# v√µtame esimesed 6
kp_ego <- data.frame(
  media_nw_df %>% 
    arrange(-degree_c) %>% 
    select(media) %>% 
    slice(1:6),
  media_nw_df %>% 
    arrange(-betweenness_c) %>% 
    select(media) %>% 
    slice(1:6),
  media_nw_df %>% 
    arrange(-closeness_c) %>% 
    select(media) %>% 
    slice(1:6),
  media_nw_df %>% 
    arrange(-eigen) %>% 
    select(media) %>% 
    slice(1:6)) %>% 
  setNames(c("degree","betweenness","closeness","eigen"))

kp_ego
```

Tabelist on n√§ha, et Wall Street Journal on k√µigi kesksuse n√§idikute osas k√µrgeima skooriga. See meediaallikas on oluline punkt v√µrgustiku teabevoos (k√µrge vahelisuskaugus), suudab teavet kiiremini levitada kui teised (l√§heduskesksus), aga ka √ºmbritsetud olulistest "isikutest" (k√µrge omavektorkesksus).

Seej√§rel USA Today, NY Times.

# 5. Kogukonnad e. *communities*

Lisaks on v√µimalik v√µrgustikus olevaid inimesi grupeerida (klasterdada) ehk vaadata kogukondi. Gruppe saab luua k√§suga `group_*`. √úlevaade erinevatest grupeerimise funktsioonidest on [siin](https://tidygraph.data-imaginist.com/reference/group_graph.html).

Loodud grupp tuleks lisada andmestikku - selleks aktiveerime andmestikust punktide osa (*nodes*) ja lisame sinna uue tunnuse k√§suga `mutate()`.

`group_infomap()`: asetab sarnased punktid v√µimalikult l√§hestikku.

```{r warning=FALSE}
set.seed(12)

media %>%
activate(nodes) %>% 
  mutate(community = as.factor(group_infomap(weights = weight))) %>%
  ggraph(layout = 'drl') +
  geom_edge_link(aes(alpha = ..index..), show.legend = F) + 
  geom_node_point(aes(colour = community), size = 7) +
  geom_node_text(aes(label = media)) + 
  scale_color_brewer(palette = "Set2") +
  theme_graph()
```

Erinevad grupeerimise aluseks olevad algoritmid v√µivad saada erinevaid tulemusi grupeerimisel.

`group_walktrap()`: grupeerib erinevaid punkte, l√§bides juhuslikke teekondi l√§bi seoste. Need punktid, mis on tihti samadel nn teekondadel saavad kokku grupeeritud.

```{r warning=FALSE}

media_community = media %>%
activate(nodes) %>% 
mutate(community = as.factor(group_walktrap(weights = weight)))

set.seed(123)
  
media_community %>%
  ggraph(layout = 'drl') +
  geom_edge_link(aes(alpha = ..index..), show.legend = F) + 
  geom_node_point(aes(colour = community), size = 7) +
  geom_node_text(aes(label = media)) + 
  scale_color_brewer(palette = "Set2") +
  theme_graph()
```

Tekkinud klastreid v√µiks ka kuidagi l√§hemalt uurida.

```{r}
media_community %>% 
  arrange(community)
```

N√§iteks n√§eme, et esimesse klastrisse kuuluvad valdavalt ajalehed, teise klastrisse TV ja neljandasse klastrisse osad Online allikad.

K√µrgema astmekesksusega punktid v√µiksid olla oma nn kogukonnas ehk klastris m√µjukamad.

```{r}
 media_community %>% 
  activate(nodes) %>% 
  mutate(degree_centrality = centrality_degree(mode = 'total', 
                                               weights = weight)) %>% 
  arrange(community)
```

K√µrgema vahelise tsentraalsusega s√µlmed v√µivad toimida silladena kogukonna erinevate osade vahel.

```{r}
 media_community %>% 
  activate(nodes) %>% 
  mutate(between_centrality = centrality_betweenness(weights = weight)) %>% 
  arrange(community)
```

# 6. Interaktiivsed joonised

T√§psemalt on v√µimalik paketi ja selle erinevate v√µimalustega tutvuda [siin](https://cran.r-project.org/web/packages/visNetwork/vignettes/Introduction-to-visNetwork.html).

```{r}
nodes_i = data.frame(id = media.node$id,
                   label = media.node$media,
                   group = media.node$type.label,
                   shape = "circle",
                   title = paste0("Audience size: ", media.node$audience.size))

edges_i = data.frame(from = media.edge$from, 
                   to = media.edge$to,
                   label = media.edge$type,
                   arrows = 'from')
```

```{r}
visNetwork(nodes = nodes_i, edges = edges_i) %>% 
  visIgraphLayout(layout = "layout_with_fr") %>%
  visLegend() %>% 
  visOptions(highlightNearest = TRUE,
             nodesIdSelection = TRUE)
```

**Veel materjale:**

-   R-is on v√µrgustikuanal√º√ºsi tegemiseks veel olemas ka pakett `igraph`, kuigi ka pakett `tidygraph` p√µhineb suures osas [igraph](https://igraph.org/r/) funktsioonidel. Rohkem [siit](https://bookdown.org/jdholster1/idsr/network-analysis.html).

-   Andmestikud v√µrgustikuanal√º√ºsi harjutamiseksü§ì

    -   [Datasets](https://github.com/briatte/awesome-network-analysis?tab=readme-ov-file#datasets){.uri}

    -   [igraphdata: A Collection of Network Data Sets for the 'igraph' Package](https://cran.r-project.org/web/packages/igraphdata/igraphdata.pdf)

    -   [Stanford Large Network Dataset Collection](https://snap.stanford.edu/data/)

    -   [Network Repository](https://networkrepository.com/)

    -   [Datasets of networks](https://chatox.github.io/networks-science-course/practicum/data/){.uri}

    -   [The Colorado Index of Complex Networks (ICON)](https://icon.colorado.edu/#!/){.uri}

    -   [Kaggle](https://www.kaggle.com/), nt:

        -   <https://www.kaggle.com/datasets/victorsoeiro/netflix-tv-shows-and-movies?select=titles.csv>

        -   <https://www.kaggle.com/datasets/victorsoeiro/disney-tv-shows-and-movies>
